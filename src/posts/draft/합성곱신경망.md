---
title: 'í•©ì„±ê³±ì‹ ê²½ë§(CNN)'
date: '2020-06-26'
category: []
draft: True
---

### í•©ì„±ê³± ì‹ ê²½ë§ (CNN)

`CNN`ì€ ì´ë¯¸ì§€ ì¸ì‹ê³¼ ìŒì„±ì¸ì‹ ë“± ë‹¤ì–‘í•œ ê³³ì—ì„œ ì‚¬ìš©ë˜ê³ ìžˆê³ ,
íŠ¹ížˆ **ì´ë¯¸ì§€ ì¸ì‹** ë”¥ëŸ¬ë‹ì˜ ê¸°ì´ˆê°€ ëœë‹¤.

### 7.1 ì „ì²´êµ¬ì¡°

`í•©ì„±ê³± ê³„ì¸µê³¼(convolutional layer)` `í’€ë§ ê³„ì¸µ(pooling layer)`ì´ ë“±ìž¥í•œë‹¤.

ì§€ê¸ˆê¹Œì§€ì˜ ì‹ ê²½ë§ì€ ì¸ì ‘ ê³„ì¸µì˜ ëª¨ë“  ë‰´ëŸ°ê³¼ ê²°í•©ë˜ì–´ìžˆì—ˆê³ , ì´ë¥¼ ì™„ì „ì—°ê²°(`fully-connected`/ ì™„ì „ê²°í•©)ì´ë¼ê³  í•œë‹¤.
ì™„ì „ížˆ ì—°ê²°ëœ ê³„ì¸µì„ **`Affine ê³„ì¸µ`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ êµ¬í˜„**í–ˆë‹¤.

> í•©ì„±ê³± : ë‘ í•¨ìˆ˜ì¤‘ í•˜ë‚˜ë¥¼ reverse or shift ì‹œì¼œê°€ë©´ì„œ ë‚˜ë¨¸ì§€ í•¨ìˆ˜ì™€ì˜ ê³±ì„ ì—°ì´ì–´ ì ë¶„í•œë‹¤.

### `Affine`ì™€ `CNN`ì˜ ì°¨ì´

-   `Affine` : input -> **Affine-ReLU -> Affine-ReLU** -> Affine-Softmax
-   `CNN` :
    input -> **Conv- ReLU-Polling** -> Conv-ReLU-Polling-> **Conv-ReLU** -> Affine-ReLU -> Affine-Softmax

    ì´ì²˜ëŸ¼ **CNNê³„ì¸µì—ì„œ Pooling ê³„ì¸µì€ ìƒëžµ**ë ìˆ˜ë„ ìžˆë‹¤.

### í•©ì„±ê³± ê³„ì¸µ

CNNì—ì„œëŠ” `íŒ¨ë”©(Padding)`, `ìŠ¤íŠ¸ë¼ì´ë“œ(Stride)`ì™€ ê°™ì€ CNN ê³ ìœ ì˜ ìš©ì–´ê°€ ë“±ìž¥í•œë‹¤.ë˜í•œ ê° ê³„ì¸µì‚¬ì´ì—ëŠ” ìž…ì²´ì ì¸ dataê°€ íë¥¸ë‹¤.

-   **ì™„ì „ì—°ê²° ê³„ì¸µì˜ ë¬¸ì œì **  
    ì§€ê¸ˆê¹Œì§€ ë³¸ ì™„ì „ì—°ê²° ì‹ ê²½ë§ì—ì„œëŠ” ì™„ì „ì—°ê²°ê³„ì¸µ(**affine** ê³„ì¸µ)ì„ ì‚¬ìš©í–ˆë‹¤.
    ì´ì—ì„œëŠ” **ì¸ì ‘í•˜ëŠ” ê³„ì¸µì˜ ë‰´ëŸ°ì´ ëª¨ë‘ ì—°ê²°ë˜ê³  ì¶œë ¥ì˜ ìˆ˜ëŠ” ìž„ì˜ë¡œ ì •í• ìˆ˜ ìžˆë‹¤.**

    ì´ë•Œì˜ ë¬¸ì œì ì€ **dataí˜•ìƒì´ ë¬´ì‹œ**ëœë‹¤ëŠ” ê²ƒì´ë‹¤.

ex) img ì˜ ê²½ìš° ê°€ë¡œ,ì„¸ë¡œ,ê¹Šì´(ìƒ‰ìƒ)ìœ¼ë¡œ êµ¬ì„±ëœ 3ì°¨ì› dataì¸ë° affineì— ìž…ë ¥í• ë•ŒëŠ” 1ì°¨ì›ìœ¼ë¡œ `flatten`í•´ì¤˜ì•¼í•œë‹¤. ì§€ê¸ˆê¹Œì§€ì˜ **_MNISTëŠ” 1x28x28ì˜ ì´ë¯¸ì§€ë¥¼ 1x784ë¡œ í‰íƒ„í™”_** í•´ì„œ Affineê³„ì¸µì— ìž…ë ¥í–ˆë‹¤.
ë”°ë¼ì„œ ì´ëŸ°ê²½ìš° 3ì°¨ì›ìƒì—ì„œ ê°€ê¹Œìš´ í”½ì…€ë¼ë¦¬ ìƒê´€ê´€ê³„ë‚˜ ì–´ë– í•œ ê·œì¹™ì„±ì´ë¼ëŠ”ê²Œ ìžˆì„ìˆ˜ ìžˆëŠ”ë° 1ì°¨ì›ìœ¼ë¡œ ìž…ë ¥ì´ ë“¤ì–´ê°€ê²Œë˜ë©´ ê·¸ëŸ¬í•œ ì •ë³´ë“¤ì€ ì‚´ë¦´ ìˆ˜ê°€ ì—†ë‹¤.

ë°˜ë©´ **í•©ì„±ê³± ê³„ì¸µì€ ì´ëŸ¬í•œ í˜•ìƒì„ ìœ ì§€í•œì±„ ì²˜ë¦¬í•˜ê³  ì „ë‹¬**í•´ì£¼ê¸° ë•Œë¬¸ì— ì œëŒ€ë¡œ ì´í•´í•  ê°€ëŠ¥ì„±ì´ ìžˆë‹¤.

CNNì—ì„œëŠ” í•©ì„±ê³±ê³„ì¸µì˜ ìž…ì¶œë ¥ ë°ì´í„°ë¥¼ `feature map`ì´ë¼ê³  í•˜ëŠ”ë° í•©ì„±ê³± ê³„ì¸µì˜ ìž…ë ¥ dataë¥¼ input feature map , ì¶œë ¥ë°ì´í„°ë¥¼ output feature map ì´ë¼ê³  í•œë‹¤.

-   **_í•©ì„±ê³± ì—°ì‚°_**
    img ì²˜ë¦¬ì—ì„œ ë§í•˜ëŠ” `filter` ì—°ì‚°ì„ ë§í•œë‹¤.
    ì¦‰ í•©ì„±ê³± ì—°ì‚°ì€ ìž…ë ¥ ë°ì´í„°ì™€ í•„í„°(ì»¤ë„) ê·¸ë¦¬ê³  ì¶œë ¥ì´ ìžˆë‹¤.

*   ì—°ì‚° ë°©ë²•:  
    í•„í„°ì˜ `window`ë¥¼ ì¼ì • ê°„ê²© ì´ë™í•´ê°€ë©´ì„œ `input data`ì— ì ìš©í•´ì£¼ëŠ” ê²ƒì´ë‹¤. ì´ë•Œ í•„í„°ì— ëŒ€ì‘í•˜ëŠ” ì—°ì‚°ì„ ì²˜ë¦¬í•´ì¤€ë‹¤.
    (**_ë‹¨ì¼ ê³±ì…ˆ ëˆ„ì‚°_** : **_Fused Multiply Add/ FMA_**
    ëŒ€ì‘í•˜ëŠ” ì›ì†Œë¼ë¦¬ ê³±í•œ í›„ ì´í•©ì„ êµ¬í•˜ëŠ”ê²ƒ,)

> scipyì—ì„œ 2ì°¨ì› í•©ì„±ê³±í•¨ìˆ˜ë¡œ ì˜ˆë¥¼ ë”°ë¼í•´ë³´ë©´ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¤ëŠ”ë°
> ê·¸ì´ìœ ëŠ” scipyì—ì„œëŠ” êµì°¨ìƒê´€ìœ¼ë¡œ í•´ì•¼í•˜ê¸°ë•Œë¬¸ì´ë‹¤. êµì°¨ìƒê´€ì€ FMAì—ì„œ filterë¥¼ flipping í•´ì¤€ ê²ƒì´ê³  ì´ë•Œì˜ flippingì´ëž€ ì¢Œìš° ìƒí•˜ í•œë²ˆì”© ë’¤ì§‘ëŠ” ê²ƒì„ ë§í•œë‹¤.(deep learningì—ì„œëŠ” flippingì„ ë”°ë¡œ êµ¬ë¶„í•˜ì§€ ì•ŠëŠ”ë‹¤.)

CNNì—ì„œëŠ” **_í•„í„°ì˜ ë§¤ê°œë³€ìˆ˜_**ê°€ ê·¸ë™ì•ˆì˜ **_ê°€ì¤‘ì¹˜ì™€ ê°™ì€ ì—­í• _**ì„ í•˜ê³ ,
íŽ¸í–¥ì˜ ê²½ìš°ì—ëŠ” í•„í„°ë¥¼ ë‹¤ ì ìš©í•œ í›„ dataì— ë”í•œë‹¤.(íŽ¸í–¥ì€ í•­ìƒ 1ê°œë§Œ ì¡´ìž¬í•œë‹¤.)

### íŒ¨ë”©(padding)

í•©ì„±ê³± ì—°ì‚°ì„ ìˆ˜í–‰í•˜ê¸°ì „ì— **_input dataì£¼ë³€ì„ 0ìœ¼ë¡œ ì±„ìš°ê¸°ë„ í•œë‹¤_**.
íŒ¨ë”©ì€ ì£¼ë¡œ ì¶œë ¥ í¬ê¸°ë¥¼ ì¡°ì ˆí•  ëª©ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ”ë°, ì™œëƒí•˜ë©´ í•©ì„±ê³±ì—°ì‚°ì„ ë˜í’€ì´í•˜ëŠ” ì‹¬ì¸µ ì‹ ê²½ë§ì—ì„œëŠ” ì¶œë ¥ì´ ìž‘ì•„ì§€ë©´ ë‹¤ìŒì˜ ìž…ë ¥ë„ ìž‘ì•„ì§€ë¯€ë¡œ ë¬¸ì œê°€ ë ìˆ˜ ìžˆì–´ì„œì´ë‹¤.(ì–´ëŠìˆœê°„ 1ì´ë˜ì–´ë²„ë¦¼).ë”°**_ë”°ë¼ì„œ íŒ¨ë”©ì„ ì¤Œìœ¼ë¡œì¨ ìž…ë ¥í¬ê¸° ê·¸ëŒ€ë¡œ ë‹¤ìŒ ì¸µì— ë„˜ê²¨ì¤„ìˆ˜ ìžˆë‹¤_**.

### ìŠ¤íŠ¸ë¼ì´ë“œ(stride)

í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ìœ„ì¹˜ê°„ê²©ì„ ìŠ¤íŠ¸ë¼ì´ë“œë¼ê³  í•œë‹¤.
(**_ìœˆë„ìš°ê°€ ì´ë™í•˜ëŠ” ê°„ê²©ì„ ì¡°ì •_**í•œë‹¤)
(ë”°ë¼ì„œ ìŠ¤íŠ¸ë¼ì´ë“œ í¬ê¸°ë¥¼ í‚¤ìš°ë©´ ì¶œë ¥ í¬ê¸°ê°€ ì¤„ì–´ë“ ë‹¤)

### íŒ¨ë”©ê³¼ ìŠ¤íŠ¸ë¼ì´ë“œ ì¶œë ¥í¬ê¸° ê³„ì‚°

ìž…ë ¥í¬ê¸°ë¥¼(H,W),í•„í„° í¬ê¸°ë¥¼ (FH, FW), ì¶œë ¥í¬ê¸°ë¥¼ (OH,OW), íŒ¨ë”©ì„ P, ìŠ¤íŠ¸ë¼ì´ë“œ S
`OH = (H + 2P -FH)/s + 1`
`OW = (W + 2P - FW)/S + 1`
ê¸€ë¡œ í’€ì–´ì„œ ë‚˜íƒ€ë‚´ë³´ë©´
`ì¶œë ¥ = (ìž…ë ¥ + 2xíŒ¨íŒ… - í•„í„°) /ìŠ¤íŠ¸ë¼ì´ë“œ + 1`

ì´ë•Œ Outputì´ ì •ìˆ˜ë¡œ ë‚˜ì™€ì•¼í•˜ëŠ”ë° ë”¥ëŸ¬ë‹ í”„ë ˆìž„ì›Œí¬ì¤‘ì—ëŠ” ì •ìˆ˜ê°€ ì•ˆë‚˜ì˜¤ë©´ ê°€ê¹Œìš´ ì •ìˆ˜ë¡œ ë°˜ì˜¬ë¦¼í•˜ëŠ” ë°©ë²•ì„ ì‚¬ìš©í•´ì£¼ëŠ” ì• ë„ ìžˆë‹¤.

### 3ì°¨ì›ì— ì ìš©ì‹œì¼œë³´ê¸°

ë§Œì•½ ê¹Šì´ë¼ëŠ” ì°¨ì›ì´ ì¶”ê°€ ë˜ì—ˆë‹¤ë©´ ê°€ë¡œ ì„¸ë¡œì— ëŒ€í•´ì„œ í•©ì„±ê³± ì—°ì‚°ì„ ë¨¼ì € ìˆ˜í–‰í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë”í•´ì„œ ì¶œë ¥ì„ ì–»ìœ¼ë©´ ëœë‹¤.

ì´ë•Œ ì£¼ì˜ì‚¬í•­ìœ¼ë¡œëŠ” inputì˜ channel ìˆ˜ì™€ í•„í„°ì˜ ì±„ë„ìˆ˜ê°€ ê°™ì•„ì•¼ í•œë‹¤ëŠ” ê²ƒ
(ê·¸ë¦¬ê³  ê° ì±„ë„ë“¤ì´ ëª¨ë‘ ê°™ì€ í¬ê¸°ì—¬ì•¼í•œë‹¤ )

ë¬´ìŠ¨ë§ì¸ì§€ ë³´ë©´
3ì°¨ì› ë°ì´í„°ë¥¼ ë‹¤ì°¨ì› ë°°ì—´ë¡œ ë‚˜íƒ€ë‚¼ë•ŒëŠ”`(C,H,W)` (ìˆœì„œëŒ€ë¡œ ì±„ë„, ë†’ì´, ë„ˆë¹„ë‹¤)
í•„í„°ë„ ì´ì™€ ê°™ì´ `(C,FH,FW)`ë¡œ ì“´ë‹¤.

í•„í„°ë¥¼ ê·¸ëƒ¥ 1ê°œì˜ í•„í„°(ì—¬ê¸°ì„œ í•„í„° 1ê°œë¼ í•˜ë©´ ì •ìœ¡ë©´ì²´ ëª¨ì–‘ì˜ ê¹Šì´ê°€ ìžˆëŠ” í•„í„°ì´ì§€ë§Œ ì±„ë„ì˜ ê³„ì‚° ê²°ê³¼ë¥¼ í•©ì³ì„œ 1ê°œì˜ ê°’ìœ¼ë¡œ ë³€í™˜í•˜ê¸°ë•Œë¬¸ì— ì¶œë ¥ê°’ì€ **ê¹Šì´ê°€ 1ì¸ outputì´ ë‚˜ì˜¤ê²Œ ëœë‹¤**. ë”°ë¼ì„œ ë‹¤ìŒìœ¼ë¡œ ì „í•´ì£¼ê¸°ìœ„í•´ì„œ ì¶œë ¥ë„ ì—¬ëŸ¬ê°œë¡œ í•˜ê³ ì‹¶ìœ¼ë©´ **_í•„í„°ë¥¼ ë³µìˆ˜ê°œ ì ìš©ì‹œì¼œ ì£¼ë©´ ëœë‹¤_** .)

```
(C, H , W ) â¨€ (FN, C, FH , FW) --> (FN, OH,OW) + (FN,1,1) --> (FN,OH,OW)
```

ì´ë ‡ê²Œ ì—°ì‚°ì—ì„œ í•„í„°ì˜ ìˆ˜ë„ ê³ ë ¤í•´ì¤˜ì•¼í•˜ëŠ”ë°, ë”°ë¼ì„œ í•„í„°ì˜ **_ê°€ì¤‘ì¹˜ dataëŠ” 4ì°¨ì›ì˜ ëª¨ì–‘ìœ¼ë¡œ ìž‘ì„±í•´ì¤€ë‹¤_** (ì¶œë ¥ê°¯ìˆ˜, ìž…ë ¥ì±„ë„ìˆ˜, ë†’ì´, ë„ˆë¹„)

### ë°°ì¹˜ì²˜ë¦¬

í•©ì„±ê³± ì—°ì‚°ë„ ë°°ì¹˜ì²˜ë¦¬ë¥¼ ì§€ì›í•œë‹¤.
ë”°ë¼ì„œ ê° ê³„ì¸µì˜ ì°¨ì›ì„ ëŠ˜ë ¤ì„œ 4ì°¨ì›ìœ¼ë¡œ ì €ìž¥í•˜ëŠ”ë°
(dataìˆ˜, ì±„ë„ìˆ˜, ë†’ì´, ë„ˆë¹„) ìˆœì„œë¡œ ì €ìž¥í•œë‹¤..

```
(N,C, H , W ) â¨€ (FN, C, FH , FW) --> (N,FN, OH,OW) + (FN,1,1) --> (N,FN,OH,OW)
```

ì´ íë¦„ì€ í•œë²ˆ í˜ëŸ¬ê°ˆë•Œë§ˆë‹¤ `data Nê°œ`ì— ëŒ€í•œ í•©ì„±ê³± ì—°ì‚°ì´ ì´ë¤„ì§„ë‹¤ëŠ” ê²ƒì´ ë°°ì¹˜ì²˜ë¦¬ì˜ ì£¼ìš” í¬ì¸íŠ¸ë‹¤.

### í’€ë§ê³„ì¸µ(Pooling)

í’€ë§ì€ ê°€ë¡œ ì„¸ë¡œ ë°©í–¥ì˜ ê³µê°„ì„ ì¤„ì´ëŠ” ì—°ì‚°ì´ë‹¤.
í’€ì–´ì„œ ìž‘ì„±í•´ë³´ë©´ í’€ë§ì´ëž€ filterì˜ ìœˆë„ìš°ë¡œ ëŒ€ìƒì˜ì—­(2x2 í•„í„°ì˜ ì˜ì—­ê³¼ ë¹„ìŠ·)ì—ì„œ íŠ¹ì • ê·œì¹™ì„ ê¸°ì¤€ìœ¼ë¡œ ê°’ì„ ë½‘ì•„ë‚´ data ê³µê°„ì„ ì¤„ì´ëŠ” ê²ƒì´ë‹¤.
ì´ë•Œ **_ëŒ€ìƒì˜ì—­(window)ì˜ í¬ê¸°ì™€ ìŠ¤íŠ¸ë¼ì´ë“œ(ì´ë™ê°„ê²©)ì€ ê°™ì€ ê°’ìœ¼ë¡œ ì„¤ì •í•˜ëŠ”ê²Œ ë³´í†µì´ë‹¤._**

> í’€ë§ì˜ ì¢…ë¥˜ì—ëŠ” **_ìµœëŒ€ í’€ë§_** ì™¸ì—ë„ **_í‰ê·  í’€ë§_**ë“±ì´ ìžˆë‹¤.(ì´ë¯¸ì§€ ë¶„ì•¼ì—ì„œëŠ” ìµœëŒ€í’€ë§ì„ ì‚¬ìš©í•œë‹¤.)

#### í’€ë§ê³„ì¸µì˜ íŠ¹ì§•

-   í•™ìŠµí•´ì•¼í•  ë§¤ê°œë³€ìˆ˜ê°€ ì—†ë‹¤.==> ëŒ€ìƒì˜ì—­ì—ì„œ ë°”ë¡œ íŠ¹ì • ì²˜ë¦¬ë¥¼ í•˜ëŠ”ê²ƒì´ë¯€ë¡œ í•™ìŠµí•  ê²ƒì´ ì—†ë‹¤.
-   ì±„ë„ ìˆ˜ê°€ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤ ==> ìž…ë ¥ ì±„ë„ìˆ˜ ê·¸ëŒ€ë¡œ ì¶œë ¥ ë°ì´í„°ë¡œ ë³´ë‚¸ë‹¤(ë…ë¦½ì ìœ¼ë¡œ ê³„ì‚°ëœë‹¤.)
-   ìž…ë ¥ì˜ ë³€í™”ì— ì˜í–¥ì„ ì ê²Œ ë°›ëŠ”ë‹¤ (ìž…ë ¥dataê°€ ì¡°ê¸ˆ ë³€í•´ë„ í’€ë§ì˜ ê²°ê³¼ëŠ” ê°™ê²Œ ë‚˜ì˜¬ìˆ˜ ìžˆë‹¤ëŠ” ë§ì´ë‹¤.)

### í•©ì„±ê³±ê³„ì¸µ êµ¬í˜„í•˜ê¸°

4ì°¨ì› ë°°ì—´

```python
x = np.random.rand(10,1,28,28)
x.shape  # (10,1,28,28)

x[0].shape #(1,28,28)
```

> `im2col`ë¡œ ë°ì´í„° ì „ê°œí•˜ê¸°  
> ì›ëž˜ í•©ì„±ê³± ì—°ì‚°ì„ ê·¸ëŒ€ë¡œ êµ¬í˜„í•˜ë ¤ë©´ forë¬¸ì„ ì¨ì•¼í•˜ê² ì§€ë§Œ ê·¸ë ‡ê²Œ ë˜ë©´ **_ë³µìž¡+ ì„±ëŠ¥ì €í•˜_**ê°€ ìƒê¸´ë‹¤. ë”°ë¼ì„œ `im2col`í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•´ë³´ìž

`im2col` : input dataë¥¼ í•„í„°ë§í•˜ê¸° ì¢‹ê²Œ ì „ê°œí•˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
(êµ¬ì²´ì ìœ¼ë¡œëŠ” í•„í„°ë¥¼ ì ìš©í•˜ëŠ” ì˜ì—­ì„ **_í•œ rowë¡œ ë³€í™˜í•´ì„œ ì „ê°œ_**í•œë‹¤.)
ëŒ€ì‹  ìŠ¤íŠ¸ë¼ì´ë“œì— ë”°ë¼ì„œ í•„í„°ë§ì‹œ ê²¹ì¹˜ëŠ” ì˜ì—­ì´ ìƒê¸¸ìˆ˜ìžˆëŠ”ë° ê·¸ë ‡ê²Œ ë˜ë©´ `im2col`ë¡œ ì „ê°œí• ë•Œ rowì˜ ê°¯ìˆ˜ê°€ ë§Žì•„ì§€ê²Œ ë˜ê³  ì´ëŠ” memoryë¥¼ ë§Žì´ ì†Œë¹„í•˜ëŠ” ë‹¨ì ì´ìžˆë‹¤. í•˜ì§€ë§Œ ê·¸ëŸ¬í•œ ë‹¨ì ì—ë„ ë¶ˆêµ¬í•˜ê³  **_ì»´í“¨í„°ëŠ” í–‰ë ¬ì˜ ê³„ì‚°ì— íŠ¹í™”ë˜ì–´ìžˆìœ¼ë¯€ë¡œ ë¬¸ì œë¥¼ í–‰ë ¬ë¡œ ë‹¨ìˆœí™” ì‹œí‚¤ë©´ íš¨ìœ¨ì„ ë†’ì¼ ìˆ˜ ìžˆë‹¤_**.

ì¦‰ ì´ ë§ì²˜ëŸ¼ `im2col`ì€ `image to column`ì˜ ì¤„ìž„ë§ì´ë‹¤.

input dataë¥¼ í–‰ë ¬ë¡œ ë°”ê¿” ì£¼ì—ˆìœ¼ë‹ˆ ì—¬ëŸ¬ìž¥ì˜ filter ë˜í•œ í–‰ë ¬ì˜ columnìœ¼ë¡œ ë°”ê¿”ì„œ í–‰ë ¬ì˜ ê³±ì„ ìˆ˜í–‰í•´ì£¼ìž
ê·¸ë¦¬ê³  ì´ëŸ¬í•œ í–‰ë ¬ì˜ ê³± ì´í›„ì—ëŠ” **_output dataê°€ 2ì°¨ì›ì´ë¯€ë¡œ reshapeë¥¼ í†µí•´ì„œ ë‹¤ì‹œ 4ì°¨ì›ìœ¼ë¡œ ë³€í˜•_**í•´ì¤˜ì•¼í•œë‹¤.

`im2col` ì„ ì´ìš©í•´ì„œ êµ¬í˜„í•˜ë©´ ì†ì‰½ê²Œ ì „ê°œí•˜ì—¬ ì—°ì‚°í•´ì¤„ ìˆ˜ìžˆëŠ”ë°
ì´ë¥¼ í†µí•´ `Affine`ê³„ì¸µê³¼ ê±°ì˜ ìœ ì‚¬í•œ í”„ë¡œì„¸ìŠ¤ë¡œ êµ¬í˜„í• ìˆ­ ìžˆë‹¤.

ë‹¨ ì£¼ì˜í• ê²ƒì€ im2colì„ ì´ìš©í•œ í•¨ìˆ˜ì˜ ì—­ì „íŒŒëŠ” `col2im`ì„ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë°
ì´ ë¶€ë¶„ë§Œ ì œì™¸í•˜ë©´ Affineê³„ì¸µê³¼ ë˜‘ê°™ë‹¤.

### í’€ë§ê³„ì¸µ êµ¬í˜„í•˜ê¸°

í’€ë§ê³„ì¸µë˜í•œ `im2col`ì„ ì‚¬ìš©í•´ì„œ dataë¥¼ ì „ê°œí•˜ëŠ”ë° ëŒ€ì‹  ì´ë•Œ ì±„ë„ì´ ë…ë¦½ì ìœ¼ë¡œ ë³´ì „ì´ ë˜ê¸°ë•Œë¬¸ì— ì•½ê°„ì˜ ì°¨ì´ê°€ ìžˆë‹¤.

ì´ì±„ë„ì˜ êµ¬ë¶„ì€ ê·¸ëƒ¥ 1~4rowê¹Œì§€ëŠ” ì±„ë„ 1, ì´ëŸ°ì‹ìœ¼ë¡œ êµ¬ë¶„í•´ì£¼ë©´ ëœë‹¤
ê·¸ë¦¬ê³  **ê° rowì—ì„œ ìµœëŒ“ê°’ì„ ë½‘ì•„ë‚´ì„œ ìˆœì„œëŒ€ë¡œ 2x2ì—ë‹¤ê°€ ë„£ì–´ì£¼ê³  dataì˜ ê°¯ìˆ˜ëŠ” ìœ ì§€í•´ì¤€ë‹¤**

###### í’€ë§ê³„ì¸µì˜ êµ¬í˜„ ë‹¨ê³„

1. ìž…ë ¥ ë°ì´í„°ë¥¼ ì „ê°œí•œë‹¤
2. í–‰ë³„ ìµœëŒ“ê°’ì„ êµ¬í•œë‹¤
3. ì ì ˆí•œ ëª¨ì–‘ìœ¼ë¡œ ì„±í˜•í•œë‹¤.

ì´ë•Œ ìµœëŒ“ê°’ì€ `np.max`ë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í• ìˆ˜ìžˆëŠ”ë° ì¶”ê°€ë¡œ ì¶• axisë¥¼ ì§€ì •í•˜ë©´ ì¶•ë§ˆë‹¤ ìµœëŒ“ê°’ì„ êµ¬í•  ìˆ˜ ìžˆë‹¤..

ì´ë ‡ê²Œ êµ¬í˜„ëœ í•©ì„±ê³±ê³„ì¸µê³¼ í’€ë§ê³„ì¸µì€ imgì¸ì‹ì— í•„ìˆ˜ì ì¸ ëª¨ë“ˆì´ë‹¤.
ì™œëƒë©´ ê³µê°„ì ì¸ í˜•ìƒì„ í•™ìŠµì— ë°˜ì˜í•´ì„œ í• ìˆ˜ ìžˆìœ¼ë¯€ë¡œ CNNì´ ì†ê¸€ì”¨ ìˆ«ìžì¸ì‹ì„ í•˜ê¸° ìˆ˜ì›”í•´ì§€ëŠ” ê²ƒì´ë‹¤.

## CNNì‹œê°í™” í•˜ê¸°

> í•™ìŠµì´ ëœ ê·œì¹™ì„±ìžˆëŠ” í•„í„°ëŠ” ë¬´ì—‡ì„ ë³´ëŠ” ê±¸ê¹Œ?
> `Edge`(ìƒ‰ìƒì´ ë³€í•˜ëŠ” ê²½ê³„ì„ )ì™€ `Blob`(êµ­ì†Œì ìœ¼ë¡œ ë©ì–´ë¦¬ì§„ ì˜ì—­)ë“±ì„ ë³´ê³ ìžˆë‹¤.
> ì´ëŸ¬í•œ ì •ë³´ë“¤ì´ ë’¤ë¡œ ì „ë‹¬ë˜ëŠ”ê²Œ CNNì—ì„œ ì¼ì–´ë‚˜ê³  ìžˆëŠ” ì¼ë“¤ì´ë‹¤.

ì¸µì´ ê¹Šì–´ì§„ë‹¤ë©´
ì²«ë²ˆì§¸ ì¸µì—ì„œ **edgeì™€ blob** 3ë²ˆì§¸ ì¸µì—ì„œ **texture**, 5ë²ˆì§¸ ì¸µì—ì„œ **object part**
ë§ˆì§€ë§‰ ì¸µì—ì„œ **object class**ì´ëŸ°ì‹ìœ¼ë¡œ ë‰´ëŸ°ì´ ë°˜ì‘í•œë‹¤.
ì¦‰ ì—¬ëŸ¬ê²¹ ìŒ“ì•„ ë‚˜ê°€ë©´ ì¸µì´ ê¹Šì–´ì§ˆìˆ˜ë¡ ë³µìž¡í•˜ê³  ì¶”ìƒí™”ëœ ì •ë³´ë¥¼ ì¶”ì¶œí• ìˆ˜ìžˆë‹¤.

### ëŒ€í‘œì ì¸ CNN

#### LeNet

`í•©ì„±ê³± ê³„ì¸µ`ê³¼ `subsampling` ê³„ì¸µì„ ë°˜ë³µí•˜ê³  ì™„ì „ì—°ê²°ê³„ì¸µì„(`Affine`) ê±°ì¹˜ë©´ì„œ ì¶œë ¥í•˜ëŠ”ë° í™œì„±í™” í•¨ìˆ˜ë¥¼ `sigmoid`ë¡œ ì‚¬ìš©í•˜ê³  ì„œë¸Œìƒ˜í”Œë§ì„ í†µí•´ ì¤‘ê°„ dataì˜ í¬ê¸°ë¥¼ ì¤„ì´ëŠ”ë° í˜„ìž¬ì˜ CNNê³¼ ì°¨ì´ê°€ ìžˆëŠ” ì´ˆê¸° ëª¨ë¸ì´ë‹¤.

#### AlexNet

`í•©ì„±ê³± ê³„ì¸µ`ê³¼ `í’€ë§ê³„ì¸µ`ì„ ê±°ì¹˜ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ `ì™„ì „ì—°ê²°ê³„ì¸µ`ì„ ê±°ì³ ê²°ê³¼ë¥¼ ì¶œë ¥í•˜ëŠ”ë° í™œì„±í™” í•¨ìˆ˜ë¡œ `ReLU`ë¥¼ ì´ìš©í•œë‹¤.
`LRN(Local Response Normalization)`ì´ë¼ëŠ” êµ­ì†Œì  ì •ê·œí™”ë¥¼ ì‹¤ì‹œí•˜ëŠ” ê³„ì¸µì„ ì´ìš©í•˜ê³ , `Dropout`ì„ ì´ìš©í•œë‹¤

ì´ëŸ¬í•œ ëª¨ë¸ì˜ ê°œë°œë¿ë§Œì•„ë‹ˆë¼. ë³‘ë ¬ê³„ì‚°ì— íŠ¹í™”ëœ GPUê°€ ë³´ê¸‰ë˜ê³ 
ë¹…ë°ì´í„°ë¥¼ í†µí•´ì„œ ë§¤ê°œë³€ìˆ˜ pittingë“± ì˜ í•´ê²°ì±… ì œì‹œë•ë¶„ì— ìš”ì¦˜ì˜ CNNì€ ë³´ë‹¤ ì§„ë³´ëœ ì„±ëŠ¥ì„ ë³´ì´ê³ ìžˆë‹¤.

### ðŸ‘¨â€ðŸ’» ì‹¤ìŠµì½”ë“œ

```python
import im2col
import sys
import os
sys.path.append(os.pardir)

# im2col(input_data, filter_h, filter_w, stride, pad)

x1 = np.random.rand(1, 3, 7, 7)
col1 = im2col(x1, 5, 5, stride=1, pad=0)
print(col1.shape)  # (9,75)

x2 = np.random.rand(10, 3, 7, 7)
col2 = im2col(x2, 5, 5, stride=1, pad=0)

print(col2.shape)  # (90,75)

# ì´ë•Œ ì¶œë ¥ë˜ëŠ” 75ì˜ í¬ê¸°ëŠ” í•„í„°ì˜ ì›ì†Œìˆ˜ì™€ ê°™ë‹¤(3*5*5)


class Convolution:
    def __init__(self, W, b, stride=1, pad=0):
        self.W = W
        self.b = b
        self.stride = stride
        self.pad = pad

    def forward(self, x):
        FN, C, FH, FW = self.W.shape
        N, C, H, W = x.shape
        out_h = int(1 + (H+2*self.pad - FH) / self.stride)
        out_w = int(1 + (W+2*self.pad-FW)/self.stride)

    # ##########################
        col = im2col(x, FH, FW, self.stride, self.pad)
        col_W = self.W.reshape(FN, -1)).T  # í•„í„° ì „ê°œ, reshape -1ì„ ì§€ì •í•˜ë©´
                        # ë‹¤ì°¨ì› ë°°ì—´ì—ì„œ ì›ì†Œìˆ˜ê°€ ë³€í™˜ í›„ì—ë„ ë˜‘ê°™ì´ ìœ ì§€ë˜ë„ë¡ ë¬¶ì–´ì¤€ë‹¤.
                        # ì¦‰ (10,3,5,5)ëŠ” ì´ 750ê°œì˜ ì›ì†Œì¸ë° reshape(10,-1)ì„ í•˜ë©´ (10,75)ë¡œ ë¬µì–´ì£¼ëŠ” ê²ƒì´ë‹¤.
        out=np.dot(col, col_w) + self.b
    # ì¤‘ìš”í•œ ë¶€ë¶„

        out=out.reshape(N, out_h, out_w, -1).transpose(0, 3, 1, 2)
        # transposeí•¨ìˆ˜ë¥¼ ì´ìš©í•˜ëŠ”ë° ì´ëŠ” axisì˜ ìˆœì„œë¥¼ ë°”ê¿”ì£¼ëŠ” ê²ƒì´ë‹¤.
        # (N,H,W,C)/ 0,1,2,3 ==transpose ==> (N,C,H,W) / 0,3,1,2
        return out


class Pooling:
    def __init__(self, poll_h, pool_w, stride = 1, pad = 0):
        self.pool_h=pool_h
        self.pool_w=pool_w
        self.stride=stride
        self.pad=pad

    def forward(self, x):
        N, C, H, W=x.shape
        out_h=int(1+(H-self.pool_h)/self.stride)
        out_w=int(1 + (W-self.pool_w)/self.stride)

        # ì „ê°œ1
        col=im2col(x, self.pool_h, self.stride, self.pad)
        col=col.reshape(-1, self.pool_h*self.pool_w)

        # ìµœëŒ“ê°’2
        out=np.max(col, axis = 1)

        # ì„±í˜•
        out=out.reshape(N, out_h, out_w, C).transpose(0, 3, 1, 2)
        return out

```
